# Libajax плагин для CakePHP

Отправляет и принимает данные от AJAX-запроса.

## Инсталяция

Вы можете установить этот плагин в свое приложение CakePHP с помощью [composer](https://getcomposer.org).

Установка плагина:

```
$ sudo composer require valeriy-brunov/libajax
$ sudo composer dumpautoload
```

#### Инициализация

Данный плагин, реализованный в виде виджета jQuery, необходимо наследовать и включать в страницу перед наследуемым кодом. Например:

```
$.widget( "namespace.nameWidget", $.lib.ajax, {});
```

#### Описание работы виджета.

В данном виджете используется метод разделения параллельных запросов путём идентификации каждого отдельного запроса к серверу. Это значит, что каждый параллельный запрос обрабатывается отдельно, имеет свой обработчик приёма ответа от сервера. Идентификатором может быть любая строка, придуманная произвольно. Идентификатор задаёт имя метода, который будет принимать и обрабатывать данные AJAX-запроса. Например, если у нас идентификатор задан строкой 'mymethod', то метод в вашем виджете, который принимает данные от AJAX-запроса будет следующим:

```js
this._mymethodSuccess( xhr );
```

Метод, который сработает перед отправкой AJAX-запроса:

```js
this._mymethodSend( data );
```

Данный виджет содержит следующие виды AJAX-запросов:
1. Простой AJAX-запрос с идентификатором;

```js
this._Ajax( data, 'строка с идентификатором' );
```

2. Метод AJAX-запроса с блокировкой. Используется в том случае, когда во временном промежутке между AJAX-запросом и приёмом данных необходимо блокировать запросы к серверу. Причём блокировка действует на запросы с одинаковым идентификатором. Запросы имеющие разные идентификаторы не блокируют друг друга;

```js
this._lockAjax( data, 'строка с идентификатором' );
```

3. Метод AJAX-запроса с удаление "слушателя". В этом случае ответ отправляется серверу, но ответ не принимается. В этом случае не возможно определить об успешности выполнение запроса на сервере.

```js
this._abortAjax( data, 'строка с идентификатором' );
```

4. Метод AJAX-запроса по таймеру. В этом случае запрос к серверу выполняется через указанный промежуток времени. Причём отсчёт времени начинается после получения ответа от сервера, как успешного, так и закончивавшегося с ошибкой.

```js
this._timerAjax( data, 'строка с идентификатором' );
```

Полный список настроек по умолчанию. Указанные настройки меняют в коде виджета, который наследует данный виджет:

```js
@type {string} _urlAjax
	Адрес запроса AJAX кода. Обязательное поле.
@type {string} _method
    Метод отправки данных на сервер ( GET|POST ). По умолчанию GET.
@type {string} _datatype
    Тип возвращаемого объекта AJAX-кодом ( html|json|xml|script|text ). По умолчанию html.
@type {string} _cache
    Кеширование AJAX-запроса. По умолчанию false (не требуется кеширование).
@type {string} _async
    Асинхронное выполнение запроса. По умолчанию true (запросы будут выполняться асинхронно).
@type {string} _namequery
    Имя запроса (идентификатор запроса).
@type {string} _time
    Время в миллисекундах через которое сработает AJAX-запрос. По умолчанию 5000 мик.сек. (5 сек.).
@param {string} idModal_error
    id модального окна, если необходимо показывать AJAX-ошибку в модальном окне. По умолчанию будет показан Alert с текстом ошибки.
```



